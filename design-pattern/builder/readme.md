# Builderパターン

- オブジェクトの生成過程の隠蔽

## ユースケース

1. オブジェクトの生成手順が複雑な場合
2. 生成するオブジェクトのプロパティが多い場合
3. コンストラクタの引数が多い、かつ、任意の引数が多い場合
4. 類似したオブジェクトを大量に生成する可能性がある場合

## 構成要素

本当は次の5つの構成要素からなるが、サンプルコードは現場に即したコードを記述した

### 1. ビルダ

- インターフェース

### 2. 具象ビルダ

- インターフェースを実装したクラス
- 構築ステップの実装をする

### 3. プロダクト

- 結果のオブジェクト
- サンプルでは `User` に該当

### 4. ディレクタ

- 構築ステップを特定の順序で実行することのみに責任を持つ
- プロダクトを手億艇の順序や構成で作成する
- クライアントがビルダを直接管理できるので必須ではない

### 5. クライアント

- サンプルコードでは `main` 関数に該当

## メリット

### 1. 生成プロセスの分離

- 複雑な生成ロジックをクラス本体から分離できる

### 2. メソッドチェーン

- 各設定メソッド(setter)で自分自身（Rustでは `Self` ）を返すことでメソッドチェーンを実現
- メソッドチェーンの利用で、オブジェクト構築のコードが直観的になる

### 3. 柔軟性の向上

- setterを設けたことで、必要なプロパティのみを設定可能になる
- オブジェクトの生成プロセスを容易に拡張できるようになる

## 補足

メソッドの引数で `impl Into<String>` を使っている箇所があるが、これは `String` 型以外も受け付けるようにしているだけ

`Into` トレイトは、型 `T` を 別の型 `U` に変換する

```rs
// ❌ 硬直的：Stringしか受け入れない
fn rigid_function(name: String) { }

// ✅ 柔軟：&str, String, Cow<str> などを受け入れ
fn flexible_function(name: impl Into<String>) {
    let owned_name: String = name.into();
}
```
